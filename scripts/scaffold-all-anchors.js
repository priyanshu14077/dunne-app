const fs = require('fs');

// Read mock-data.ts to extract BASE_PRODUCTS
const mockDataPath = '/Users/priyanshu/Desktop/dunne-2/lib/mock-data.ts';
const mockData = fs.readFileSync(mockDataPath, 'utf8');

// Extract product entries line by line
const lines = mockData.split('\n');
const products = [];

let currentProduct = null;

for (const line of lines) {
    const idMatch = line.match(/^\s*id:\s*'([^']+)'/);
    const nameMatch = line.match(/^\s*name:\s*'([^']+)'/);
    const typeMatch = line.match(/^\s*type:\s*'([^']+)'/);
    const imageMatch = line.match(/^\s*image:\s*'([^']+)'/);

    if (idMatch) {
        if (currentProduct && currentProduct.id && currentProduct.type && currentProduct.image) {
            products.push(currentProduct);
        }
        currentProduct = { id: idMatch[1] };
    }

    if (currentProduct) {
        if (nameMatch) currentProduct.name = nameMatch[1];
        if (typeMatch) currentProduct.type = typeMatch[1];
        if (imageMatch) currentProduct.image = imageMatch[1];
    }
}

// Push the last product
if (currentProduct && currentProduct.id && currentProduct.type && currentProduct.image) {
    products.push(currentProduct);
}

console.log(`Found ${products.length} base products.`);

// Generate lib/anchor.ts
let output = `// Auto-generated anchor points from manual mapping
// DO NOT EDIT THIS FILE DIRECTLY - edit anchor-points.md instead

export interface AnchorPoint {
  x: number;
  y: number;
  rotation: number;
  scale: number;
  label?: string;
}

export interface BreakpointAnchors {
  mobile: AnchorPoint[];   // < 768px
  tablet: AnchorPoint[];   // 768px - 1024px
  desktop: AnchorPoint[];  // > 1024px
}

export interface ProductAnchorData {
  id: string;
  category: string;
  imageUrl: string;
  anchors: BreakpointAnchors;
  center: { x: number; y: number };
}

export const PRODUCT_ANCHORS: Record<string, ProductAnchorData> = {
`;

products.forEach(p => {
    const category = p.type === 'bracelet' ? 'bracelets' : 'necklaces';
    output += `  "${p.id}": {
    id: "${p.id}",
    category: "${category}",
    imageUrl: "${p.image}",
    anchors: {
      mobile: [],
      tablet: [],
      desktop: []
    },
    center: { x: 50, y: 50 }
  },
`;
});

output += `};
`;

fs.writeFileSync('/Users/priyanshu/Desktop/dunne-2/lib/anchor.ts', output, 'utf8');
console.log(`âœ… Generated lib/anchor.ts with ${products.length} products (all empty, ready for configuration).`);
